---
title: "Spatiotemporal Variation of Adult C. californicus Shell Allometry"
author: "Malloy and Ul-Hasan and Lewis et al"
date: "May 13, 2019"
output:
  word_document: default
  pdf_document: default
---

Last edited [Sabah Ul-Hasan]: May 13, 2019

https://github.com/MichaelMalloy/C_californicus_Morphology

Contributors of data by order of contribution: MM, SUH, SC, CAO
Contributors of code by order of contribution: SUH, LL, MM

Data Clean-up       Post-processing: Raw -> Clean -> SoCal      Lines 24 - 151
Fig 1a-b            Map of C. californicus range                Lines 153 - 263
Fig 2b,Supp Fig 1   Shell allometry (shell manual)              Lines 265 - 324
Fig 3a-d,Supp Fig 2 Size and Shape vs Lat / Temp, Bergmann's    Lines 326 - 507
Fig 4a-d            Size and Shape vs Coastal Proxmity          Lines 509 - 565
Tables              Statistics breakdown (of all figures)       Lines 567 -

Overview of data and post-processing
```{r}

###### Upload data ######
# install.packages("RCurl")
library("RCurl") # package needed for downloading data from Github repo
# packageVersion("RCurl") # v1.95.4.12 

Raw <- read.csv(text=getURL("https://raw.githubusercontent.com/MichaelMalloy/C_californicus_Morphology/master/SupplementalTable2_Data-Raw.csv")) 

# Ensure blanks are read as NAs
###### Upload data ######


###### Data structure ######
str(Raw) # Quick view of RawData

# Plots of shell morphology measurements as a point of reference for outliers 
morphos = c("Globosity_WoverL", "Length_mm", "Width_mm", "Aperture_mm", "Thickness_mm") 

# install.packages("PerformanceAnalytics")
library("PerformanceAnalytics") # Need package for correlation charts
# packageVersion("PerformanceAnalytics") # v1.5.2

# install.packages("tidyverse")
library("tidyverse") # Need package pipes ( %>% or "then" )
# packageVersion("tidyverse") # v1.2.1
 
chart.Correlation(Raw %>% select(morphos)) # we can see outliers here
###### Data structure ######


###### Clean-up ######
# Subset for shells without aperture / thickness (iNat will be included)
Raw_globoshells = subset(Raw, is.na(Raw$Thickness_mm))
Raw_iNat = subset(Raw, Raw$Collection=="iNat") # 99 specifically from iNat

# Filter outliers (min and max values identified by viewing Raw)
# Confirmed outliers from operator error (measuring or datasheet input)
Clean_OutliersRemoved = Raw %>% # 2996 obs 
  filter(Thickness_mm < 2) %>% # low thickness
  filter(!(Width_mm < 15 & Thickness_mm > 2)) %>% # too thick for width
  filter(Aperture_mm < 6) %>%  # small aperture
  filter(!(Length_mm > 20 & Aperture_mm <2)) %>% # aperture too small for length
  rbind(Raw_globoshells) %>%   # adds 775 shells back in *length that's above the threshold?
  filter(Width_mm > 2) %>%  # too narrow (note this gets rid of iNat)
  rbind(Raw_iNat) %>% # add iNat back in
  filter(Globosity_WoverL > 0.42 & Globosity_WoverL < 0.71 ) %>% 
  data.frame # ensure it's a data frame
# Remove 25 shells from Pliocene (too old, few)
Clean_OutliersRemoved=subset(Clean_OutliersRemoved, !Epoch=="Pliocene")

# 50 shells of original 2996 removed (2946 obs)
length(Raw %>% filter(Thickness_mm >= 2) %>% .$Specimen_Number)
paste(length(Raw$Specimen_Number)-length(Clean_OutliersRemoved$Specimen_Number), "removed of", length(Raw$Specimen_Number), "shells")

# Ensure updated Clean dataset has 3 or more specimens per lot
Clean = Clean_OutliersRemoved %>% 
  group_by(Lot_Number) %>% 
  mutate(Specimens_per_Lot = length((Lot_Number))) %>%
  ungroup %>% 
  filter(Specimens_per_Lot > 2 | Collection == "iNat") # keep catalogs with > 2 in lot and iNat (1 per 'lot')

# 61 shells of original 2996 removed, 11 from Clean_OutliersRemoved (2935 obs)
paste(length(Raw$Specimen_Number)-length(Clean$Specimen_Number), "removed of", length(Raw$Specimen_Number), "shells")

# Validation check for NA values for final data set
cat("\n\n",
    sum(is.na(Clean$Globosity_WoverL)), "have no globosity ratio,\n", # 0
    sum(is.na(Clean$Width_mm)), "have no width measurement,\n", # 99 [iNat]
    sum(is.na(Clean$Length_mm)), "have no length measurement,\n", # 99 [iNat]
    sum(is.na(Clean$Thickness_mm)), "have no thickness measurement,\n", # 742 = 99 [iNat] + 338 PR + 273 Pleisto
    sum(is.na(Clean$Aperture_mm)), "have no aperture measurement" ) # 742 = 99 [iNat] + 338 PR + 273 Pleisto

# Order the data
Clean %>% group_by(Lot_Number) %>% summarise(N = length(Specimen_Number))
Clean %>% group_by(Epoch) %>% summarise(N = length(Specimen_Number)) 

# Re-do of correlation chart
chart.Correlation(Clean %>% select(morphos)) # much improved

# Parameters for SoCal points
counties = c("Sonoma", "San Mateo", "Monterey", "San Luis Obispo", "Santa Barbara", "Ventura", "Los Angeles", "Orange", "San Diego", "Baja California")
Raw$County = factor(Raw$County, levels=counties) # order counties

socal = c("Santa Barbara", "Ventura", "Los Angeles", "Orange", "San Diego")
Clean_SoCal = Clean %>% filter(County %in% socal) # 2597 obs for SoCal 

socal_locations = c("SB", "NLA", "LA", "SLA", "SD", "ANA", "SCZI", "SRI", "SMI", "CAT", "SBI", "SNI", "SCI") # socal location order
Clean_SoCal$Location = factor(Clean_SoCal$Location, levels=socal_locations) # order 

# Distribution of shells by county
Clean_SoCal %>% group_by(County) %>% summarise(N = length(Epoch)) %>% data.frame 
# Check correlation for SoCal subset
chart.Correlation(Clean_SoCal %>% select(morphos)) # Also looks good
###### Clean-up ######


###### Save cleaned-up data for downstream visualization and analysis ######

# Data structure for Clean and SoCal subset
sort(unique(Clean$Collection)) # Unique collections: 9
sort(unique(Clean$Catalog)) # Unique lots: 379 
sort(unique(Clean$County)) # Unique counties: 10
sort(unique(Clean$Location)) # Unique locations: 20
sort(unique(Clean$Land_Category)) # Unique location types: 3
sort(unique(Clean$Habitat)) # Unique habitats: 4
sort(unique(Clean$Depth)) # Unique depths: 3

sort(unique(Clean_SoCal$Collection)) # Unique collections: 9
sort(unique(Clean_SoCal$Catalog)) # Unique lots: 333 
sort(unique(Clean_SoCal$County)) # Unique counties: 5
sort(unique(Clean_SoCal$Location)) # Unique locations: 13

write.csv(Clean, file = "SupplementalTable3_Data-Clean.csv")
write.csv(Clean_SoCal, file = "SupplementalTable4_Data-SoCal.csv") 
# Validation check 
Clean <- read.csv(text=getURL("https://raw.githubusercontent.com/MichaelMalloy/C_californicus_Morphology/master/SupplementalTable3_Data-Clean.csv")) 
Clean_SoCal <- read.csv(text=getURL("https://raw.githubusercontent.com/MichaelMalloy/C_californicus_Morphology/master/SupplementalTable4_Data-SoCal.csv")) 

###### Save cleaned-up data for downstream visualization and analysis ######

# Subset data by Epoch to color code points
Anthro = subset(Clean, Epoch=="Anthropocene") # 1492
Holo = subset(Clean, Epoch=="Holocene") # 1138
Pleisto = subset(Clean, Epoch=="Pleistocene") # 305

```

Figure 1a-b: Maps of shell locations (Clean and SoCal Data) 
```{r}

# install.packages("ggplot2")
library("ggplot2")
# packageVersion("ggplot2") # v3.1.0.9000
# devtools::install_github("dkahle/ggmap") 
library("ggmap")
# packageVersion("ggmap") # v3.0.0.900
# install.packages("rgdal")
library("rgdal")
# packageVersion("rgdal") # v1.3.6

# This code is personalized by account and only runs if you have a key
# Instructions:https://github.com/dkahle/ggmap
# Visit your personal Google Maps Platform to retrieve key if you have one
# ggmap::register_google(key = " ") 

# Create parameters and background maps for Clean and Clean_SoCal
# Parameters for All points

All_bbox <- make_bbox(lat = Latitude, lon = Longitude, data = Clean)
All_bbox
#       left     bottom      right        top 
#   -122.9015   25.8435 -114.7285   38.7465 

# Load polygons for ecoregions and call them after downloaded in your folder
# shape files from http://www.marineregions.org/
NC_poly=readOGR( "northern_ecoregions" , layer="ecoregions") 
SCB_poly=readOGR( "southern_ecoregions" , layer="ecoregions") 
MT_poly=readOGR( "magdaelena_ecoregions" , layer="ecoregions") 

All=get_map(location=c(-125,20,-105,40), # adjust to include regions
            zoom = 5, 
            maptype = "terrain") 

SoCal_bbox = make_bbox(lat = Latitude, lon = Longitude, data = Clean_SoCal)
SoCal_bbox
#       left     bottom      right        top 
#      -120.6695   32.4425 -116.9405   34.5875  

SoCal=get_map(location=c(-121,32,-116.5,35), 
            zoom = 7, 
            maptype = "terrain") 

# Figure 1a
SoCal_box = data.frame(x=c(-121,-121,-116.5,-116.5,-121), 
       y=c(35,32,32,35,35)) # create box for zoom of SoCal

Clean_map = ggmap(All) +
  geom_polygon(data = NC_poly, aes(x = long, y = lat),
               fill = "white", alpha = 0.5) + # white
  geom_polygon(data = SCB_poly, aes(x = long, y = lat),
               fill = "blue", alpha = 0.3) + # blue
  geom_polygon(data = MT_poly, aes(x = long, y = lat),
               fill = "#666666", alpha = 0.5) + # grey
  stat_density_2d(data = Clean, # density
                  aes(x = Longitude,
                      y = Latitude,
                      fill = stat(level)),
                  alpha = .25,
                  bins = 250,
                  geom = "polygon") +
  scale_fill_gradientn(colors = "black") + # color fill, orange
  geom_point(data = Anthro, aes(x = Longitude, y = Latitude), 
               color = "#FC4E07",
             size = 1) + # aqua
  geom_point(data = Holo, aes(x = Longitude,y = Latitude), 
             color = "#E7B800", 
             size = 1) + # seagreen
  geom_point(data = Pleisto, aes(x = Longitude, y = Latitude), 
             color = "#00AFBB",
             size = 1) + # blue 
  geom_path(data=SoCal_box, aes(x,y), color="black", lwd=1) + # insert box
  labs(x="Longitude", y="Latitude") 
Clean_map
ggsave("Figure1a_Data-Clean_Map.png", dpi = 800)

# Figure 1b
Anthro_SoCal = subset(Clean_SoCal, Epoch=="Anthropocene") # 1366
Holo_SoCal = subset(Clean_SoCal, Epoch=="Holocene") # 1020
Pleisto_SoCal = subset(Clean_SoCal, Epoch=="Pleistocene") # 211

CleanSoCal_map = ggmap(SoCal) +
  geom_polygon(data = NC_poly, aes(x = long, y = lat),
               fill = "white", alpha = 0.5) + # white
  geom_polygon(data = SCB_poly, aes(x = long, y = lat),
               fill = "blue", alpha = 0.3) + # blue
  stat_density_2d(data = Clean_SoCal, # density
                  aes(x = Longitude,
                      y = Latitude,
                      fill = stat(level)),
                  alpha = .35,
                  bins = 250,
                  geom = "polygon") +
  scale_fill_gradientn(colors = "black") + # color fill, orange
  geom_point(data = Anthro_SoCal, aes(x = Longitude, y = Latitude), 
               color = "#FC4E07",
             size = 2) + 
  geom_point(data = Holo_SoCal, aes(x = Longitude,y = Latitude), 
             color = "#E7B800", 
             size = 2) + 
  geom_point(data = Pleisto_SoCal, aes(x = Longitude, y = Latitude), 
             color = "#00AFBB",
             size = 2) + 
    geom_path(data=SoCal_box, aes(x,y), color="black", lwd=1) + # insert box
  labs(x="Longitude", y="Latitude")
CleanSoCal_map
ggsave("Figure1b_Data-Clean-SoCal_Map.png", dpi = 800)

```

Figure 2b, Supp Figure 1: Allometry - shell shape vs size (Clean) 
```{r}

# install.packages("GGally")
library(GGally)
# packageVersion("GGally") # v1.4.0
# install.packages("ggplot2")
library(ggplot2)
# packageVersion("ggplot2") # v3.1.0

# Create a function for including linear regression line
my_fn <- function(data, mapping, ...){
  p <- ggplot(data = data, mapping = mapping) + 
    geom_point() + 
    geom_smooth(method=lm, color="black", ...) 
  p
}

# Figure 2
Fig2 = Clean[,c("Epoch", "Length_mm", "Width_mm", "Globosity_WoverL")] 
# Rename columns
names(Fig2) = c("Epoch", "Length", "Width", "Globosity") 
# Create figure (automatically excludes NAs)
Fig2_chart = ggpairs(Fig2, aes(color = Epoch, alpha = 0.85), lower = list(continuous = my_fn), upper = list(continuous = wrap("cor", size = 4.25)))
# Change colors manually with a loop through each plot
for(i in 1:Fig2_chart$nrow) {
  for(j in 1:Fig2_chart$ncol){
    Fig2_chart[i,j] <- Fig2_chart[i,j] + 
        scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
        scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB"))  
  }
}

Fig2_chart + 
  theme_classic() # theme for figure
ggsave("Figure2b_Data-Clean_Shell-Allometry.png", dpi = 800)

# Supplemental Figure 1
SuppFig1 = Clean[,c("Epoch", "Length_mm", "Width_mm", "Globosity_WoverL", "Thickness_mm", "Aperture_mm")] 
# Rename columns
names(SuppFig1) = c("Epoch", "Length", "Width", "Globosity", "Thickness", "Aperture") 
# Create figure (automatically excludes NAs)
SuppFig1_chart = ggpairs(SuppFig1, aes(color = Epoch, alpha = 0.85), lower = list(continuous = my_fn), upper = list(continuous = wrap("cor", size = 4.25)))
# Change colors manually with a loop through each plot
for(i in 1:SuppFig1_chart$nrow) {
  for(j in 1:SuppFig1_chart$ncol){
    SuppFig1_chart[i,j] <- SuppFig1_chart[i,j] + 
        scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
        scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB"))  
  }
}

SuppFig1_chart + 
  theme_classic() # theme for figure
ggsave("SuppFigure1_Data-Clean_Shell-Allometry.png", dpi = 800)

# Length = Width, globosity independent of length and width
# size = length=width, aperture and thickness are neglible as dependent on size (see categories)
# shape = globosity
```

Figure 3a-d, Supp Figure 2: Comparison of size and shape for Latitude vs SST (Clean)
```{r}

# Regression Plot function
ggplotRegression <- function (fit) {

require(ggplot2)

ggplot(fit$model, aes_string(x = names(fit$model)[2], y = names(fit$model)[1])) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  labs(title = paste("Adj R2 = ",signif(summary(fit)$adj.r.squared, 5),
                     "Intercept =",signif(fit$coef[[1]],5 ),
                     " Slope =",signif(fit$coef[[2]], 5),
                     " P =",signif(summary(fit)$coef[2,4], 5)))
}

# Supplemental Figure 2
SuppFig2 = ggplot(data = Clean, 
                      aes(x = Latitude, y = Mean_SST,
                      color = Epoch,
                      alpha = 0.4)) +
  annotate("rect",ymin=-Inf,ymax=Inf,xmin=32.56,xmax=34.49, # adjust by transformation
            alpha=0.2, fill="black") + # shade square
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Latitude", y="Mean SST")
SuppFig2 +
  theme_classic() 
ggsave("SuppFig2_Data-Clean_Latitude-MeanSST.png", dpi = 800)
# Regression by Epoch
ggplotRegression(lm(Mean_SST ~ Latitude, data = Clean))
# ** y = 34.464 - 0.548x, r^2 = 0.181, p = 1.750 x 10^-129
ggplotRegression(lm(Mean_SST ~ Latitude, data = Anthro))
# ** y = 43.679 - 0.810x, r^2 = 0.413, p = 1.487 x 10^-174
ggplotRegression(lm(Mean_SST ~ Latitude, data = Holo))
# ** y = 30.666 - 0.428x, r^2 = 0.392, p = 5.674 x 10^-125
ggplotRegression(lm(Mean_SST ~ Latitude, data = Pleisto))
# ** y = 32.702 - 0.591, r^2 = 0.457, p = 1.704 x 10^-42 

# Figure 3a-d (for Length) 
SuppFig3a = ggplot(data = Clean, 
                      aes(x = Latitude, y = Length_mm,
                      color = Epoch,
                      alpha = 0.4)) +
  annotate("rect",ymin=-Inf,ymax=Inf,xmin=32.56,xmax=34.49, # adjust by transformation
            alpha=0.2, fill="black") + # shade square
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Latitude", y="Size (Length mm)")
SuppFig3a +
  theme_classic() 
ggsave("SuppFig3a_Data-Clean_Latitude-Length.png", dpi = 800)
ggplotRegression(lm(Latitude ~ Length_mm, data = Clean))
ggplotRegression(lm(Latitude ~ Length_mm, data = Anthro))
ggplotRegression(lm(Latitude ~ Length_mm, data = Holo))
ggplotRegression(lm(Latitude ~ Length_mm, data = Pleisto))

SuppFig3b = ggplot(data = Clean, 
                      aes(x = Mean_SST, y = Length_mm,
                      color = Epoch,
                      alpha = 0.4)) +
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Mean SST", y="Size (Length mm)")
SuppFig3b +
  theme_classic() 
ggsave("SuppFig3b_Data-Clean_MeanSST-Length.png", dpi = 800)
ggplotRegression(lm(Mean_SST ~ Length_mm, data = Clean))
ggplotRegression(lm(Mean_SST ~ Length_mm, data = Anthro))
ggplotRegression(lm(Mean_SST ~ Length_mm, data = Holo))
ggplotRegression(lm(Mean_SST ~ Length_mm, data = Pleisto))

SuppFig3c = ggplot(data = Clean, 
                      aes(x = Latitude, y = Globosity_WoverL,
                      color = Epoch,
                      alpha = 0.4)) +
  annotate("rect",ymin=-Inf,ymax=Inf,xmin=32.56,xmax=34.49, # adjust by transformation
            alpha=0.2, fill="black") + # shade square
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Latitude", y="Shape (Globosity, W/L)")
SuppFig3c +
  theme_classic() 
ggsave("SuppFig3c_Data-Clean_Latitude-Globosity.png", dpi = 800)
ggplotRegression(lm(Latitude ~ Globosity_WoverL, data = Clean))
ggplotRegression(lm(Latitude ~ Globosity_WoverL, data = Anthro))
ggplotRegression(lm(Latitude ~ Globosity_WoverL, data = Holo))
ggplotRegression(lm(Latitude ~ Globosity_WoverL, data = Pleisto))

SuppFig3d = ggplot(data = Clean, 
                      aes(x = Mean_SST, y = Globosity_WoverL,
                      color = Epoch,
                      alpha = 0.4)) +
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Mean SST", y="Shape (Globosity, W/L)")
SuppFig3d +
  theme_classic() 
ggsave("SuppFig3d_Data-Clean_MeanSST-Globosity.png", dpi = 800)
ggplotRegression(lm(Mean_SST ~ Globosity_WoverL, data = Clean))
ggplotRegression(lm(Mean_SST ~ Globosity_WoverL, data = Anthro))
ggplotRegression(lm(Mean_SST ~ Globosity_WoverL, data = Holo))
ggplotRegression(lm(Mean_SST ~ Globosity_WoverL, data = Pleisto))

# Figure 3a-b (for Width) 
SuppFig3a = ggplot(data = Clean, 
                      aes(x = Latitude, y = Width_mm,
                      color = Epoch,
                      alpha = 0.4)) +
  annotate("rect",ymin=-Inf,ymax=Inf,xmin=32.56,xmax=34.49, # adjust by transformation
            alpha=0.2, fill="black") + # shade square
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Latitude", y="Size (Width mm)")
SuppFig3a +
  theme_classic() 
ggsave("SuppFig3a_Data-Clean_Latitude-Width.png", dpi = 800)
ggplotRegression(lm(Latitude ~ Width_mm, data = Clean))
# ** y = 32.394 + 0.0915x, r^2 = 0.064, p = 1.310 x 10^-42
ggplotRegression(lm(Latitude ~ Width_mm, data = Anthro))
# ** y = 32.613 + 0.052x, r^2 = 0.053, p = 2.625 x 10^-18 
ggplotRegression(lm(Latitude ~ Width_mm, data = Holo))
# ** y = 32.186 + 0.119x, r^2 = 0.075, p = 3.376 x 10^-21
ggplotRegression(lm(Latitude ~ Width_mm, data = Pleisto))
# ** y = 32.547 + 0.085x, r^2 = 0.050, p = 4.657 x 10^-5

SuppFig3b = ggplot(data = Clean, 
                      aes(x = Mean_SST, y = Width_mm,
                      color = Epoch,
                      alpha = 0.4)) +
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Mean SST", y="Size (Width mm)")
SuppFig3b +
  theme_classic() 
ggsave("SuppFig3b_Data-Clean_MeanSST-Width.png", dpi = 800)
ggplotRegression(lm(Mean_SST ~ Width_mm, data = Clean))
# y = 16.231 - 0.009x, r^2 = 1.209 x 10^-5, p = 0.309
ggplotRegression(lm(Mean_SST ~ Width_mm, data = Anthro))
# y = 16.663 - 7.955x10^-5x, r^2 = -0.001, p = 0.993
ggplotRegression(lm(Mean_SST ~ Width_mm, data = Holo))
# ** y = 17.346 - 0.091x, r^2 = 0.094, p = 2.222 x 10^-26
ggplotRegression(lm(Mean_SST ~ Width_mm, data = Pleisto))
# y = 13.191 - 0.021x, r^2 = 0.001, p = 0.255

```

Figure 4a-d: Comparison of size and shape for Coastal Proxmity (Clean) 
```{r}

Fig4a = ggplot(data = Clean, 
                      aes(x = Latitude, y = Length_mm,
                      alpha = 0.1)) +
  geom_point(aes(fill = Epoch)) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_color_manual(values=c("#73FA79", "#D783FF")) + #73FA79 green
  annotate("rect",ymin=-Inf,ymax=Inf,xmin=32.56,xmax=34.49, # adjust by transformation
            alpha=0.2, fill="black") + # shade square
  geom_boxplot(aes(color = Coastal_Proximity, fill = Epoch), method=lm, se = TRUE) + # 95% confidence interval
  labs(x="Latitude", y="Size (Length mm)")
Fig4a +
  theme_classic() 
ggsave("Fig4a_Data-Clean_Latitude-Length_Coasts.png", dpi = 800)
  
Fig4b = ggplot(data = Clean, 
                      aes(x = Mean_SST, y = Length_mm,
                      alpha = 0.1)) +
  geom_point(aes(fill = Epoch)) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_color_manual(values=c("#73FA79", "#D783FF")) + #73FA79 green
    geom_boxplot(aes(color = Coastal_Proximity, fill = Epoch), method=lm, se = TRUE) + # 95% confidence interval
  labs(x="Mean SST", y="Size (Length mm)")
Fig4b +
  theme_classic() 
ggsave("Fig4b_Data-Clean_MeanSST-Length_Coasts.png", dpi = 800)

Fig4c = ggplot(data = Clean, 
                      aes(x = Latitude, y = Globosity_WoverL,
                      alpha = 0.1)) +
  geom_point(aes(fill = Epoch)) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_color_manual(values=c("#73FA79", "#D783FF")) + #73FA79 green
  annotate("rect",ymin=-Inf,ymax=Inf,xmin=32.56,xmax=34.49, # adjust by transformation
            alpha=0.2, fill="black") + # shade square
  geom_boxplot(aes(color = Coastal_Proximity, fill = Epoch), method=lm, se = TRUE) + # 95% confidence interval
  labs(x="Latitude", y="Shape (Globosity, W/L)")
Fig4c +
  theme_classic() 
ggsave("Fig4c_Data-Clean_Latitude-Shape_Coasts.png", dpi = 800)

Fig4d = ggplot(data = Clean, 
                      aes(x = Mean_SST, y = Globosity_WoverL,
                      alpha = 0.1)) +
  geom_point(aes(fill = Epoch)) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_color_manual(values=c("#73FA79", "#D783FF")) + #73FA79 green
    geom_boxplot(aes(color = Coastal_Proximity, fill = Epoch), method=lm, se = TRUE) + # 95% confidence interval
  labs(x="Mean SST", y="Shape (Globosity, W/L)")
Fig4d +
  theme_classic() 
ggsave("Fig4d_Data-Clean_MeanSST-Globosity_Coasts.png", dpi = 800)

```

Tables: Statistics of all figures
```{r}

##### Supp Tables 1-2 #####
# Shell morphometrics (Figure 2, Supplemental Figure 1)
# Supp Table 1: anovas
aov1 <- aov(Length ~ Epoch, data = SuppFig1)
summary(aov1)
TukeyHSD(aov1)

aov2 <- aov(Width ~ Epoch, data = SuppFig1)
summary(aov2)
TukeyHSD(aov2)

aov3 <- aov(Globosity ~ Epoch, data = SuppFig1)
summary(aov3)
TukeyHSD(aov3)

aov4 <- aov(Thickness ~ Epoch, data = SuppFig1)
summary(aov4)
TukeyHSD(aov4)

aov5 <- aov(Aperture ~ Epoch, data = SuppFig1)
summary(aov5)
TukeyHSD(aov5)

# # Supp Table 2: Linear models (regression)
# *glm and lm are them same if you're using gaussian distribution
# *glm is different if you transform the data
summary(lm(Length ~ Width, data = SuppFig1)) # lm 1
summary(lm(Length ~ Globosity, data = SuppFig1)) # lm 2
summary(lm(Length ~ Thickness, data = SuppFig1)) # lm 3
summary(lm(Length ~ Aperture, data = SuppFig1)) # lm 4

summary(lm(Width ~ Globosity, data = SuppFig1)) # lm 5
summary(lm(Width ~ Thickness, data = SuppFig1)) # lm 6
summary(lm(Width ~ Aperture, data = SuppFig1)) # lm 7

summary(lm(Globosity ~ Thickness, data = SuppFig1)) # lm 8
summary(lm(Globosity ~ Aperture, data = SuppFig1)) # lm 9

summary(lm(Thickness ~ Aperture, data = SuppFig1)) # lm 10

##### Supp Tables 1-2 #####

##### Supp Table 3, Table 1 #####
# Factoring for Latitude and Sea Surface Temperature, Epoch
# Supp Table 3
# Linear models 
summary(lm(Mean_SST ~ Latitude, data = Clean)) # lm 11
summary(lm(Mean_SST ~ Latitude + Epoch, data = Clean)) # lm 12

# anovas
aov6 <- aov(Mean_SST ~ Epoch, data = Clean)
summary(aov6)
TukeyHSD(aov6)

aov7 <- aov(Latitude ~ Epoch, data = Clean)
summary(aov7)
TukeyHSD(aov7)

# Table 1: Linear models
summary(lm(Length_mm ~ Mean_SST, data = Clean)) # lm 13
summary(lm(Length_mm ~ Latitude, data = Clean)) # lm 14
summary(lm(Length_mm ~ Mean_SST + Latitude, data = Clean)) # lm 15
summary(lm(Length_mm ~ Mean_SST + Epoch, data = Clean)) # lm 16
summary(lm(Length_mm ~ Latitude + Epoch, data = Clean)) # lm 17
summary(lm(Length_mm ~ Mean_SST + Latitude + Epoch, data = Clean)) # lm 18

summary(lm(Globosity_WoverL ~ Mean_SST, data = Clean)) # lm 19
summary(lm(Globosity_WoverL ~ Latitude, data = Clean)) # lm 20
summary(lm(Globosity_WoverL ~ Mean_SST + Latitude, data = Clean)) # lm 21
summary(lm(Globosity_WoverL ~ Mean_SST + Epoch, data = Clean)) # lm 22
summary(lm(Globosity_WoverL ~ Latitude + Epoch, data = Clean)) # lm 23
summary(lm(Globosity_WoverL ~ Mean_SST + Latitude + Epoch, data = Clean)) # lm 24

summary(lm(Width_mm ~ Mean_SST, data = Clean)) # lm 25
summary(lm(Width_mm ~ Latitude, data = Clean)) # lm 26
summary(lm(Width_mm ~ Mean_SST + Latitude, data = Clean)) # lm 27
summary(lm(Width_mm ~ Mean_SST + Epoch, data = Clean)) # lm 28
summary(lm(Width_mm ~ Latitude + Epoch, data = Clean)) # lm 29
summary(lm(Width_mm ~ Mean_SST + Latitude + Epoch, data = Clean)) # lm 30
##### Supp Table 3, Table 1 #####

##### Supp Table 4 #####
# anovas
aov8 <- aov(Length_mm ~ Coastal_Proximity, data = Clean)
summary(aov8)
TukeyHSD(aov8)

aov9 <- aov(Length_mm ~ Ecoregion, data = Clean)
summary(aov9)
TukeyHSD(aov9)

aov10 <- aov(Globosity_WoverL ~ Coastal_Proximity, data = Clean)
summary(aov10)
TukeyHSD(aov10)

aov11 <- aov(Globosity_WoverL ~ Ecoregion, data = Clean)
summary(aov11)
TukeyHSD(aov11)

aov12 <- aov(Width_mm ~ Coastal_Proximity, data = Clean)
summary(aov12)
TukeyHSD(aov12)

aov13 <- aov(Width_mm ~ Ecoregion, data = Clean)
summary(aov13)
TukeyHSD(aov13)
##### Supp Table 4 #####

```
