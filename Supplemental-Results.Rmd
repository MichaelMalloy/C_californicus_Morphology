---
title: "Bergmannâ€™s Rule across the Pleistocene, Holocene, and Anthropocene in an Eastern Pacific neogastropod, Californiconus californicus (Reeve, 1844) (Gastropoda: Conidae)"
author: "Malloy and Ul-Hasan et al"
date: "Feb 19, 2020"
output:
  pdf_document: default
---

Last edited [Sabah Ul-Hasan]: Feb 19, 2020

https://github.com/MichaelMalloy/C_californicus_Morphology

Contributors of data by order of contribution: MM, SUH, SC, CAO, JKK, WFG
Contributors of code by order of contribution: SUH, LL, MM, SS, CAO

Data Clean-up        Post-processing: Raw -> Clean + SoCal       
*Fig 1a-b            Map of C. californicus range                
*Fig 2b              Shell allometry (Fig 2a of shell manual)             
*Fig 3a-d,Supp Fig 1 Size or Shape and Lat / Temp, Bergmann's    
*Fig 4a-f,Supp Fig 2 Size or Shape and Ecoregion + Proxmity      
*Tables 1-2          Statistics breakdown (of all figures)      
*Supp Fig 3          Correlations to human population density    
*Cope's Rule         Size by location ~ Epoch                    

Overview of data and post-processing
```{r}

###### Upload data ######
# Need package for downloading data from Github repo
## install.packages("RCurl")
library("RCurl") 
## packageVersion("RCurl") # v1.98.1.1 

Raw <- read.csv(text=getURL("https://raw.githubusercontent.com/MichaelMalloy/C_californicus_Morphology/master/SupplementalTable2_Data-Raw.csv")) 

Key <- read.csv(text=getURL("https://raw.githubusercontent.com/MichaelMalloy/C_californicus_Morphology/master/SupplementalTable1_Data-Key.csv")) 

# Ensure blanks are read as NAs
###### Upload data ######


###### Data structure ######
# Quick view of RawData
str(Raw) 

# Plots of shell morphology measurements as a point of reference for outliers 
morphos = c("Length_mm", "Width_mm", "Aperture_mm", "Thickness_mm", "Globosity_WoverL", "Geometric_Mean")

# Need package for correlation charts
## install.packages("PerformanceAnalytics")
library("PerformanceAnalytics") 
## packageVersion("PerformanceAnalytics") # v2.0.4

# Need package pipes ( %>% or "then" )
## install.packages("tidyverse")
library("tidyverse") 
## packageVersion("tidyverse") # v1.3.0

# Check for outliers by correlation matrix
Raw_CorrMatrix = chart.Correlation(Raw %>% 
                                     select(morphos)) 
Raw_CorrMatrix
###### Data structure ######


###### Clean-up ######
# Organization of locations in dataset
## Re-order counties, North to South
counties = c("Sonoma", "San Mateo", "Monterey", "San Luis Obispo", "Santa Barbara", "Ventura", "Los Angeles", "Orange", "San Diego", "Baja California")
Raw$County = factor(Raw$County, levels=counties) # order counties
## Order SoCal counties and locales for when subsetting SoCal data
socal = c("Santa Barbara", "Ventura", "Los Angeles", "Orange", "San Diego")
socal_locations = c("SB", "NLA", "LA", "SLA", "SD", "ANA", "SCZI", "SRI", "SMI", "CAT", "SBI", "SNI", "SCI") # socal location order
la = "Los Angeles"

# Filter outliers (min/max values identified by Raw correlations)
## Subset for including back in as part of Clean / filtered set (below)
No_TA = subset(Raw, is.na(Raw$Thickness_mm)) # 775 no T or A
Raw_iNat = subset(Raw, Raw$Collection=="iNat") # 99 from iNat
## Confirmed to be operator error (measuring or datasheet input)
OutliersRemoved = Raw %>% # 2996 obs 
  filter(Thickness_mm < 2) %>% # low T
  filter(!(Width_mm < 15 & Thickness_mm > 2)) %>% # too thick for W
  filter(Aperture_mm < 6) %>%  # small A
  filter(!(Length_mm > 20 & Aperture_mm <2)) %>% # A too small for L
  rbind(No_TA) %>%  # adds 775 shells back in 
  filter(Width_mm > 2) %>%  # too narrow (note this gets rid of iNat)
  rbind(Raw_iNat) %>% # add iNat back in
  filter(Globosity_WoverL > 0.42 & Globosity_WoverL < 0.71 ) %>% 
  data.frame # ensure it's a data frame
## Remove 25 shells from Pliocene (too old, few)
OutliersRemoved=subset(OutliersRemoved, !Epoch=="Pliocene")
## Filter specimens that may skew in being in the open ocean and/or too north or south
min(OutliersRemoved$Latitude) # 26.43
max(OutliersRemoved$Latitude) # 38.16
### Ensure updated Clean dataset has 3 or more specimens per lot
Clean = OutliersRemoved %>% 
  filter(Latitude > 26.43) %>% 
  filter(Latitude < 38.16) %>% 
  group_by(Lot_Number) %>% 
  mutate(Specimens_per_Lot = length((Lot_Number))) %>%
  ungroup %>% 
  filter(Specimens_per_Lot > 2 | Collection == "iNat") # keep catalogs with > 2 in lot and iNat (1 per 'lot')
## Validation check for NA values for final data set
cat("\n\n",
    sum(is.na(Clean$Globosity_WoverL)), "have no globosity ratio,\n", # 0
    sum(is.na(Clean$Geometric_Mean)), "have no geometric mean,\n", # 99 [iNat]
    sum(is.na(Clean$Width_mm)), "have no width measurement,\n", # 99 [iNat]
    sum(is.na(Clean$Length_mm)), "have no length measurement,\n", # 99 [iNat]
    sum(is.na(Clean$Thickness_mm)), "have no thickness measurement,\n", # 742 = 99 [iNat] + 338 PR + 273 Pleisto
    sum(is.na(Clean$Aperture_mm)), "have no aperture measurement" ) # 742 = 99 [iNat] + 338 PR + 273 Pleisto
## Order the data
Clean %>% 
  group_by(Lot_Number) %>% 
  summarise(N = length(Specimen_Number))
Clean %>% 
  group_by(Epoch) %>% 
  summarise(N = length(Specimen_Number)) 
## Re-do of correlation chart
Clean_CorrMatrix = chart.Correlation(Clean %>% 
                                       select(morphos)) # much improved
Clean_CorrMatrix
dev.copy(png,'Figure2b_Clean.jpg')
dev.off()

# Subset Clean (2908 of 2996 from Raw) to SoCal (2608)
SoCal = Clean %>% 
  filter(County %in% 
           socal) 
SoCal$Location = factor(SoCal$Location, levels=socal_locations) # order 
# Distribution of shells by county *most are in LA (1372)
SoCal %>% 
  group_by(County) %>% 
  summarise(N = length(Epoch)) %>% 
  data.frame 
# Check correlation for SoCal subset
SoCal_CorrMatrix = chart.Correlation(SoCal %>% 
                                       select(morphos)) # Also looks good
SoCal_CorrMatrix
dev.copy(png,'Figure2b_SoCal.jpg')
dev.off()

# Subset 
LA = SoCal %>% 
  filter(County %in% 
           la) 
LA$Location = factor(LA$Location, levels=socal_locations) # order 
# Check correlation for LA subset
LA_CorrMatrix = chart.Correlation(LA %>%
                                    select(morphos)) #
LA_CorrMatrix
dev.copy(png,'Figure2b_LA.jpg')
dev.off()
###### Clean-up ######



###### Save cleaned-up data for downstream visualization and analysis ######
# Data structure for Clean and SoCal subset
sort(unique(Clean$Collection)) # Unique collections: 9
sort(unique(Clean$Lot_Number)) # Unique lots: 382 
sort(unique(Clean$County)) # Unique counties: 9
sort(unique(Clean$Location)) # Unique locations: 19
sort(unique(Clean$Coastal_Proximity)) # Unique location types: 2
sort(unique(Clean$Habitat)) # Unique habitats: 4
sort(unique(Clean$Depth)) # Unique depths: 3

sort(unique(SoCal$Collection)) # Unique collections: 9
sort(unique(SoCal$Lot_Number)) # Unique lots: 339
sort(unique(SoCal$County)) # Unique counties: 4
sort(unique(SoCal$Location)) # Unique locations: 13

write.csv(Clean, file = "SupplementalTable3_Data-Clean.csv")
write.csv(SoCal, file = "SupplementalTable4_Data-SoCal.csv") 

# Validation check 
Clean <- read.csv(text=getURL("https://raw.githubusercontent.com/MichaelMalloy/C_californicus_Morphology/master/SupplementalTable3_Data-Clean.csv")) 
SoCal <- read.csv(text=getURL("https://raw.githubusercontent.com/MichaelMalloy/C_californicus_Morphology/master/SupplementalTable4_Data-SoCal.csv")) 


###### Save cleaned-up data for downstream visualization and analysis ######

# Subset data by Epoch to color code points
Anthro = subset(Clean, Epoch=="Anthropocene") # 1492
Holo = subset(Clean, Epoch=="Holocene") # 1106
Pleisto = subset(Clean, Epoch=="Pleistocene") # 305

Anthro_SoCal = subset(SoCal, Epoch=="Anthropocene") # 1366
Holo_SoCal = subset(SoCal, Epoch=="Holocene") # 1020
Pleisto_SoCal = subset(SoCal, Epoch=="Pleistocene") # 211

```

Figure 1a-b: Maps of shell locations (Clean and SoCal Data) 
```{r}

# Need packages for map coordinates
## if(!requireNamespace("devtools")) install.packages("devtools")
## devtools::install_github("dkahle/ggmap")
library("ggmap")
## packageVersion("ggmap") # v3.0.0
## install.packages("rgdal")
library("rgdal")
## packageVersion("rgdal") # v1.4.8
# Need package for plots of maps
## install.packages("ggplot2")
library("ggplot2")
## packageVersion("ggplot2") # v3.2.1
# Need package for gridding maps as one figure
## install.packages("cowplot")
library("cowplot")
## packageVersion("cowplot") # v1.0.0

# This code is personalized by account and only runs if you have a key
## Instructions: https://github.com/dkahle/ggmap
## Visit your personal Google Maps Platform to retrieve key if you have one
## ggmap::register_google(key = " ") 

# Load polygons for ecoregions and call them after downloaded in your folder 
## shape files from http://www.marineregions.org/ (also in repo)
NC_poly=readOGR( "northern_ecoregions" , layer="ecoregions") 
SCB_poly=readOGR( "southern_ecoregions" , layer="ecoregions") 
MT_poly=readOGR( "magdaelena_ecoregions" , layer="ecoregions") 

# Figure 1a
## Parameters for All points
All_bbox <- make_bbox(lat = Latitude, lon = Longitude, data = Clean)
All_bbox
##     left        bottom    right       top 
##     -122.786    27.359    -114.734    37.721 
All=get_map(location=c(-125,20,-105,40), # adjust to include regions
            zoom = 5, 
            maptype = "terrain") 
## Create box for zoom of SoCal
SoCal_box = data.frame(x=c(-121,-121,-116.5,-116.5,-121), 
       y=c(35,32,32,35,35)) 
## Plot map
Clean_map = ggmap(All) +
  geom_polygon(data = NC_poly, aes(x = long, y = lat),
               fill = "white", alpha = 0.5) + # white
  geom_polygon(data = SCB_poly, aes(x = long, y = lat),
               fill = "blue", alpha = 0.3) + # blue
  geom_polygon(data = MT_poly, aes(x = long, y = lat),
               fill = "#666666", alpha = 0.5) + # grey
  stat_density_2d(data = Clean, # density
                  aes(x = Longitude,
                      y = Latitude,
                      fill = stat(level)),
                  alpha = .25,
                  bins = 250,
                  geom = "polygon") +
  scale_fill_gradientn(colors = "black") + # color fill, black
  geom_point(data = Anthro, aes(x = Longitude, y = Latitude), 
             color = "#FC4E07", # orange
             alpha = 0.15,
             size = 1) + 
  geom_point(data = Holo, aes(x = Longitude,y = Latitude), 
             color = "#E7B800", # gold
             alpha = 0.15,
             size = 1) + 
  geom_point(data = Pleisto, aes(x = Longitude, y = Latitude), 
             color = "#00AFBB", # blue
             alpha = 0.15,
             size = 1) + 
  geom_point(data = Key, aes(x = Longitude, y = Latitude), # asbsent data
             color = "#FC4E07", # orange
             shape = 4,
             size = 1.5) + # manually add Punta Abreojos white circle
  geom_path(data=SoCal_box, aes(x,y), color="black", lwd=1) + # insert box
  labs(x="Longitude", y="Latitude") 
Clean_map

# Figure 1b
SoCal_bbox = make_bbox(lat = Latitude, lon = Longitude, data = SoCal)
SoCal_bbox
##    left        bottom    right       top
##    -120.6685   32.4635 -116.9615   34.5865 

SoCal=get_map(location=c(-121,32,-116.5,35), 
            zoom = 7, 
            maptype = "satellite") 

SoCal$Latitude = as.numeric(SoCal$Latitude)
SoCal$Longitude = as.numeric(SoCal$Longitude)

SoCal = data.frame(SoCal)

SoCal_map = ggmap(SoCal) +
  stat_density_2d(data = SoCal, # density
                  aes(x = Longitude,
                      y = Latitude,
                      fill = stat(level)),
                  alpha = .35,
                  bins = 250,
                  geom = "polygon") +
  scale_fill_gradientn(colors = "black") + 
  geom_point(data = Anthro_SoCal, aes(x = Longitude, y = Latitude), 
             color = "#FC4E07",
             alpha = 0.15,
             size = 2) + 
  geom_point(data = Holo_SoCal, aes(x = Longitude,y = Latitude), 
             color = "#E7B800", 
             alpha = 0.15,
             size = 2) + 
  geom_point(data = Pleisto_SoCal, aes(x = Longitude, y = Latitude), 
             color = "#00AFBB",
             alpha = 0.15,
             size = 2) + 
    geom_path(data=SoCal_box, aes(x,y), color="black", lwd=1) + # insert box
  labs(x="Longitude", y="Latitude")
SoCal_map


ggsave("Figure1b_Data-Clean-SoCal_Map.png", dpi = 800)


ggsave("Figure1a_Data-Clean_Map.png", dpi = 800)

##### Create Map (Figure 1a-b) #####
#  Need a personalized account with API key (map key) for Google maps
## Instructions: https://github.com/dkahle/ggmap
## ggmap::register_google(key = " ") 
### More helpful info: https://www.littlemissdata.com/blog/maps 

# Figure 1a: Larger map
## Parameters for All points
All_bbox <- make_bbox(lat = Latitude, lon = Longitude, data = df)
All_bbox # Informs us what to set for parameters
##     left        bottom    right       top 
##     -122.786    27.359    -114.734    37.721 
All=get_map(location=c(-129,20,-105,42), # adjust to include regions
            zoom = 5, 
            maptype = "terrain") # can adjust this type as well
## Create box for zoom of SoCal
SoCal_box = data.frame(x=c(-121,-121,-116.5,-116.5,-121), 
       y=c(35,32,32,35,35)) 
## Plot map 
Figure1a = ggmap(All) + # Google map of parameters
  geom_polygon(data = NC_poly, aes(x = long, y = lat), # polygons (shape files)
               fill = "white", alpha = 0.5) + 
  geom_polygon(data = SCB_poly, aes(x = long, y = lat),
               fill = "blue", alpha = 0.3) +
  geom_polygon(data = MT_poly, aes(x = long, y = lat),
               fill = "#666666", alpha = 0.5) + # grey
  stat_density_2d(data = df, # hypothetical population density
                  aes(x = Longitude,
                      y = Latitude,
                      fill = stat(level)),
                  alpha = .25,
                  bins = 250, # can adjust this for resolution
                  geom = "polygon") +
  scale_fill_gradientn(colors = "black") + # fills density layers as black 
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) + # colors by Epoch
  geom_point(data = df, aes(x = Longitude, y = Latitude, color = Epoch), 
             alpha = 0.15,
             size = 1) + # layers points
  geom_path(data=SoCal_box, aes(x,y), color="black", lwd=1) + # insert box
  labs(x="Longitude", y="Latitude") +
  theme(legend.position="none")
Figure1a

# Figure 1b: Zoom-in of SoCal
SoCal=get_map(location=c(-121,32,-116.5,35), # adjust based on SoCal_box
            maptype = "terrain-background") # can adjust this type as well
## Plot map
Figure1b = ggmap(SoCal) +
  geom_polygon(data = NC_poly, aes(x = long, y = lat),
               fill = "white", alpha = 0.5) + # white
  geom_polygon(data = SCB_poly, aes(x = long, y = lat),
               fill = "blue", alpha = 0.3) + # blue
    stat_density_2d(data = df, # density
                  aes(x = Longitude,
                      y = Latitude,
                      fill = stat(level)),
                  alpha = .25,
                  bins = 250,
                  geom = "polygon") +
  scale_fill_gradientn(colors = "black") + # color fill, black
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_point(data = df, aes(x = Longitude, y = Latitude, color = Epoch), 
             alpha = 0.15,
             size = 1) +
  theme(axis.title.x=element_blank(), axis.title.y=element_blank())
Figure1b # Note the ecoregions cut-out if polygon not fully included

# Grid using cowplot, and save
Figure1 = plot_grid(Figure1a, Figure1b, labels = c("A", "B"), label_size=12)
Figure1   

ggsave("Figure1.png", dpi = 800) 

##### Create Map (Figure 1a-b) #####

```

Figure 2b: Are shell size, mass, or shape independent or dependent metrics of each other?
```{r}

# install.packages("GGally")
library(GGally)
# packageVersion("GGally") # v1.4.0

# Create a function for including linear regression line
my_fn <- function(data, mapping, ...){
  p <- ggplot(data = data, mapping = mapping) + 
    geom_point() + 
    geom_smooth(method=lm, color="black", ...) 
  p
}

# Figure 2b
Fig2b = Clean[,c("Epoch", "Length_mm", "Width_mm", "Globosity_WoverL", "Geometric_Mean")] 
# Rename columns
names(Fig2b) = c("Epoch", "Length (size)", "Width (size)", "Globosity (shape)", "geomM (mass)") 
# Create figure (automatically excludes NAs)
Fig2b_chart = ggpairs(Fig2b, aes(color = Epoch, alpha = 0.85), lower = list(continuous = my_fn), upper = list(continuous = wrap("cor", size = 4.25)))
# Change colors manually with a loop through each plot
for(i in 1:Fig2b_chart$nrow) {
  for(j in 1:Fig2b_chart$ncol){
    Fig2b_chart[i,j] <- Fig2b_chart[i,j] + 
        scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
        scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB"))  
  }
}

Fig2b_chart + 
  theme_classic() # theme for figure
ggsave("Figure2b_Data-Clean-New_Shell-Allometry.png", dpi = 800)

# Statistics
names(Fig2b) = c("Epoch", "Length", "Width", "Globosity", "geomM") 
summary(lm(Length ~ Width, data = Fig2b)) # Radj = 0.9534, p < 2.2e-16
summary(lm(Length ~ Globosity, data = Fig2b)) # Radj = 0.0853, p < 2.2e-16
summary(lm(Width ~ Globosity, data = Fig2b)) # Radj = 0.007822, p = 2.796e-06 
summary(lm(Length ~ geomM, data = Fig2b)) # Radj = 0.9884, p < 2.2e-16
summary(lm(Width ~ geomM, data = Fig2b)) # Radj = 0.988, p < 2.2e-16
summary(lm(Globosity ~ geomM, data = Fig2b)) # Radj = 0.03698, p < 2.2e-16

# Length = Width, dependent on each other and synonymous with size
# Globosity (shape) is an independent metric of size 
## Width slightly more independent (horizontal line to globosity) than Length
### Thus, use Width as proxy for size 
# geomM (mass) is synonymous with size in this instance, and independent of shape
## Do we want to then only use geomM (mass) and globosity (shape)?
### Note Width is still the most horizontal of the 3 (Length, Width, geomM) for Fig 2b ()

```

Q2) Do size/shape vary by epoch in relation to latitude or temperature? Yes.
Figure 3a-d, Supp Figure 1: Comparison of size and shape for Latitude vs SST (Clean)
```{r}

# Regression Plot function for y = mx + b
ggplotRegression <- function (fit) {

require(ggplot2)

ggplot(fit$model, aes_string(x = names(fit$model)[2], y = names(fit$model)[1])) + 
  geom_point() +
  stat_smooth(method = "lm", col = "red") +
  labs(title = paste("Adj R2 = ",signif(summary(fit)$adj.r.squared, 5),
                     "Intercept =",signif(fit$coef[[1]],5 ),
                     " Slope =",signif(fit$coef[[2]], 5),
                     " P =",signif(summary(fit)$coef[2,4], 5)))
}

# Supplemental Figure 1: What is the relationship between latitude and SST?
SuppFig1 = ggplot(data = Clean, 
                      aes(x = Latitude, y = Mean_SST,
                      color = Epoch,
                      alpha = 0.4)) +
  annotate("rect",ymin=-Inf,ymax=Inf,xmin=32.56,xmax=34.49, # adjust by transformation
            alpha=0.2, fill="black") + # shade square
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Latitude", y="Mean SST")
SuppFig1 +
  theme_classic() 
ggsave("SuppFig1_Data-Clean-New_Latitude-MeanSST.png", dpi = 800)
# Regression by Epoch
ggplotRegression(lm(Mean_SST ~ Latitude, data = Clean))
# ** y = 38.222 - 0.660x, r^2 = 0.157, p = 5.302 x 10^-110
ggplotRegression(lm(Mean_SST ~ Latitude, data = subset(Clean, Epoch=="Anthropocene")))
# ** y = 43.679 - 0.810x, r^2 = 0.413, p = 1.487 x 10^-174
ggplotRegression(lm(Mean_SST ~ Latitude, data = subset(Clean, Epoch=="Holocene")))
# ** y = 35.303 - 0.565x, r^2 = 0.259, p = 7.868 x 10^-74
ggplotRegression(lm(Mean_SST ~ Latitude, data = subset(Clean, Epoch=="Pleistocene")))
# ** y = 32.702 - 0.591, r^2 = 0.457, p = 1.704 x 10^-42

# Figure 3a-d (size is represented as Width) 
Fig3a = ggplot(data = Clean, 
                      aes(x = Latitude, y = Length_mm,
                      color = Epoch,
                      alpha = 0.4)) +
  annotate("rect",ymin=-Inf,ymax=Inf,xmin=32.56,xmax=34.49, # adjust by transformation
            alpha=0.2, fill="black") + # shade square
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Latitude", y="Size (Length mm)") +
  theme(legend.position = "none") 
# Regression by Epoch
ggplotRegression(lm(Latitude ~ Length_mm, data = Clean))
# ** y = 32.837 + 0.057x, r^2 = 0.043, p = 1.056 x 10^-28
## Relationships by Epoch are not important based on global interactive model results (Tab 1)

Fig3b = ggplot(data = Clean, 
                      aes(x = Mean_SST, y = Length_mm,
                      color = Epoch,
                      alpha = 0.4)) +
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Mean SST", y="") +
  theme(legend.position = "none") 
# Regression by Epoch
ggplotRegression(lm(Mean_SST ~ Length_mm, data = Clean))
# y = 16.050 + 0.005x, r^2 = 2.267 x 10^-4, p = 0.545
ggplotRegression(lm(Mean_SST ~ Length_mm, data = subset(Clean, Epoch=="Anthropocene")))
# y = 16.663 - 7.955x10^-5x, r^2 = -0.001, p = 0.993
ggplotRegression(lm(Mean_SST ~ Length_mm, data = subset(Clean, Epoch=="Holocene")))
# ** y = 17.009 - 0.065x, r^2 = 0.057, p = 7.759 x 10^-26
ggplotRegression(lm(Mean_SST ~ Length_mm, data = subset(Clean, Epoch=="Pleistocene")))
# y = 13.191 - 0.021x, r^2 = 0.001, p = 0.255

Figure3 = plot_grid(Fig3a , Fig3b, labels = c("A", "B"), label_size=12)
ggsave("Fig3_Length.png", dpi = 800)








Fig3c = ggplot(data = Clean, 
                      aes(x = Latitude, y = Globosity_WoverL,
                      color = Epoch,
                      alpha = 0.4)) +
  annotate("rect",ymin=-Inf,ymax=Inf,xmin=32.56,xmax=34.49, # adjust by transformation
            alpha=0.2, fill="black") + # shade square
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Latitude", y="Shape (Globosity, W/L)")
Fig3c +
  theme_classic() 
ggsave("Fig3c_Data-Clean_Latitude-Globosity.png", dpi = 800)
# Regression by Epoch
ggplotRegression(lm(Latitude ~ Globosity_WoverL, data = Clean))
# ** y = 31.951 + 2.645x, r^2 = 0.013, p = 8.232e-10
ggplotRegression(lm(Latitude ~ Globosity_WoverL, data = subset(Clean, Epoch=="Anthropocene")))
# ** y = 31.235 + 3.662x, r^2 = 0.028, p = 5.554e-11
ggplotRegression(lm(Latitude ~ Globosity_WoverL, data = subset(Clean, Epoch=="Holocene")))
# y = 33.297 + 0.697x, r^2 = -1.745e-5, p = 0.322
ggplotRegression(lm(Latitude ~ Globosity_WoverL, data = subset(Clean, Epoch=="Pleistocene")))
# ** y = 36.22 - 5.014x, r^2 = 0.025, p = 0.004

Fig3d = ggplot(data = Clean, 
                      aes(x = Mean_SST, y = Globosity_WoverL,
                      color = Epoch,
                      alpha = 0.4)) +
  scale_color_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  scale_fill_manual(values=c("#FC4E07", "#E7B800", "#00AFBB")) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Epoch)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(aes(color = Epoch, fill = Epoch), method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Mean SST", y="Shape (Globosity, W/L)")
Fig3d +
  theme_classic() 
ggsave("Fig3d_Data-Clean_MeanSST-Globosity.png", dpi = 800)
# Regression by Epoch
ggplotRegression(lm(Mean_SST ~ Globosity_WoverL, data = Clean))
# ** y = 17.072 - 1.619x, r^2 = 0.001, p = 0.024
ggplotRegression(lm(Mean_SST ~ Globosity_WoverL, data = subset(Clean, Epoch=="Anthropocene")))
# ** y = 21.187 - 7.901x, r^2 = 0.083, p = 4.988e-30
ggplotRegression(lm(Mean_SST ~ Globosity_WoverL, data = subset(Clean, Epoch=="Holocene")))
# ** y = 13.424 + 4.866x, r^2 = 0.035, p = 3.155e-10
ggplotRegression(lm(Mean_SST ~ Globosity_WoverL, data = subset(Clean, Epoch=="Pleistocene")))
# ** y = 13.21 - 0.237x, r^2 = -0.003, p = 0.875




ggplotRegression(lm(Mean_SST ~ Coastal_Proximity, data = subset(Clean))) # p = 0.923
ggplotRegression(lm(Mean_SST ~ Coastal_Proximity, data = subset(Clean, Epoch=="Anthropocene"))) # p < 0.0001
ggplotRegression(lm(Mean_SST ~ Coastal_Proximity, data = subset(Clean, Epoch=="Holocene")))
# p < 0.0001
ggplotRegression(lm(Mean_SST ~ Coastal_Proximity, data = subset(Clean, Epoch=="Pleistocene"))) # p = 0.03


# Regression by Epoch
ggplotRegression(lm(Mean_SST ~ Geometric_Mean, data = Clean))
# 
ggplotRegression(lm(Mean_SST ~ Geometric_Mean, data = subset(Clean, Epoch=="Anthropocene")))
#
ggplotRegression(lm(Mean_SST ~ Geometric_Mean, data = subset(Clean, Epoch=="Holocene")))
# **
ggplotRegression(lm(Mean_SST ~ Geometric_Mean, data = subset(Clean, Epoch=="Pleistocene")))
# 

```

Q3) Do size/shape vary in relation to ecoregion and coastal proximity? Yes.
Figure 4a-f, Supp Fig 2: Size vs shape for ecoregion and coastal proximity
(Clean_New)
```{r}

# install.packages("ggplot2")
library(ggplot2)
# packageVersion("ggplot2") # v3.1.0

# Supplemental Figure 2: What is the relationship between ecoregion, coastal proximity, and SST?
min(Clean_New$Mean_SST) # 9.68
max(Clean_New$Mean_SST) # 19.52831

SuppFig2a <- ggplot(subset(Clean_New, Epoch=="Pleistocene"), aes(x = Ecoregion, y = Mean_SST, fill = Coastal_Proximity)) +
  geom_boxplot(alpha=0.7) +
  coord_cartesian(ylim = c(9.5,20)) +
  scale_y_continuous(name = "Mean SST") +
  scale_x_discrete(name = "Ecoregion") +
  ggtitle("(a) Pleistocene") +
  theme_bw() +
  theme(plot.title = element_text(size = 14, family = "Tahoma", face = "bold"),
        text = element_text(size = 12, family = "Tahoma"),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11)) 
SuppFig2a
ggsave("SuppFig2a_Data-Clean-New_Ecoregion-Proximity-MeanSST.png", dpi = 800)

SuppFig2b <- ggplot(subset(Clean_New, Epoch=="Holocene"), aes(x = Ecoregion, y = Mean_SST, fill = Coastal_Proximity)) +
  geom_boxplot(alpha=0.7) +
  coord_cartesian(ylim = c(9.5,20)) +
  scale_y_continuous(name = "Mean SST") +
  scale_x_discrete(name = "Ecoregion") +
  ggtitle("(b) Holocene") +
  theme_bw() +
  theme(plot.title = element_text(size = 14, family = "Tahoma", face = "bold"),
        text = element_text(size = 12, family = "Tahoma"),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11)) 
SuppFig2b
ggsave("SuppFig2b_Data-Clean-New_Ecoregion-Proximity-MeanSST.png", dpi = 800)

SuppFig2c <- ggplot(subset(Clean_New, Epoch=="Anthropocene"), aes(x = Ecoregion, y = Mean_SST, fill = Coastal_Proximity)) +
  geom_boxplot(alpha=0.7) +
  coord_cartesian(ylim = c(9.5,20)) +
  scale_y_continuous(name = "Mean SST") +
  scale_x_discrete(name = "Ecoregion") +
  ggtitle("(c) Anthropocene") +
  theme_bw() +
  theme(plot.title = element_text(size = 14, family = "Tahoma", face = "bold"),
        text = element_text(size = 12, family = "Tahoma"),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11)) 
SuppFig2c
ggsave("SuppFig2c_Data-Clean-New_Ecoregion-Proximity-MeanSST.png", dpi = 800)

# Figure 4a-f
min(Clean_New$Width_mm) # 3.23
max(Clean_New$Width_mm) # 23.65
min(Clean_New$Globosity_WoverL) # 0.43
max(Clean_New$Globosity_WoverL) # 0.7









library("ggsignif")
library("ggpubr")

Fig4a <- ggplot(subset(Clean, Epoch=="Pleistocene"), aes(x = Ecoregion, y = Geometric_Mean, fill = Coastal_Proximity)) +
  geom_boxplot(alpha=0.7) +
  coord_cartesian(ylim = c(3,24)) +
  scale_y_continuous(name = "Mass (Geometric Mean)") +
  scale_x_discrete(name = "Ecoregion") +
  ggtitle("(a) Pleistocene") +
  geom_signif(comparisons=list("Ecoregion","Coastal_Proximity"), map_signif_level=TRUE) + 
  stat_compare_means(method = "t.test") +
  theme_bw() +
  theme(plot.title = element_text(size = 14, family = "Tahoma", face = "bold"),
        text = element_text(size = 12, family = "Tahoma"),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11)) 
Fig4a


Fig4b <- ggplot(subset(Clean, Epoch=="Holocene"), aes(x = Ecoregion, y = Geometric_Mean, fill = Coastal_Proximity)) +
  geom_boxplot(alpha=0.7) +
  coord_cartesian(ylim = c(3,24)) +
  scale_y_continuous(name = "Size (Width mm)") +
  scale_x_discrete(name = "Ecoregion") +
  ggtitle("(b) Holocene") +
  geom_signif(comparisons=list("Ecoregion"), map_signif_level=TRUE) + 
  stat_compare_means(method = "t.test") +
  theme_bw() +
  theme(plot.title = element_text(size = 14, family = "Tahoma", face = "bold"),
        text = element_text(size = 12, family = "Tahoma"),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11)) 
Fig4b
ggsave("Fig4b_Data-Clean-New_Ecoregion-Proximity-Width.png", dpi = 800)

Fig4c <- ggplot(subset(Clean, Epoch=="Anthropocene"), aes(x = Ecoregion, y = Geometric_Mean, fill = Coastal_Proximity)) +
  geom_boxplot(alpha=0.7) +
  coord_cartesian(ylim = c(3,24)) +
  scale_y_continuous(name = "Size (Width mm)") +
  scale_x_discrete(name = "Ecoregion") +
  ggtitle("(c) Anthropocene") +
  theme_bw() +
  theme(plot.title = element_text(size = 14, family = "Tahoma", face = "bold"),
        text = element_text(size = 12, family = "Tahoma"),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11)) 
Fig4c
ggsave("Fig4c_Data-Clean-New_Ecoregion-Proximity-Width.png", dpi = 800)

Fig4d <- ggplot(subset(Clean, Epoch=="Pleistocene"), aes(x = Ecoregion, y = Globosity_WoverL, fill = Coastal_Proximity)) +
  geom_boxplot(alpha=0.7) +
  coord_cartesian(ylim = c(.4,.72)) +
  scale_y_continuous(name = "Shape (Globosity, W/L)") +
  scale_x_discrete(name = "Ecoregion") +
  ggtitle("(d)") +
  theme_bw() +
  theme(plot.title = element_text(size = 14, family = "Tahoma", face = "bold"),
        text = element_text(size = 12, family = "Tahoma"),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11)) 
Fig4d
ggsave("Fig4d_Data-Clean-New_Ecoregion-Proximity-Width.png", dpi = 800)

Fig4e <- ggplot(subset(Clean, Epoch=="Holocene"), aes(x = Ecoregion, y = Globosity_WoverL, fill = Coastal_Proximity)) +
  geom_boxplot(alpha=0.7) +
  coord_cartesian(ylim = c(.4,.72)) +
  scale_y_continuous(name = "Shape (Globosity, W/L)") +
  scale_x_discrete(name = "Ecoregion") +
  ggtitle("(e)") +
  theme_bw() +
  theme(plot.title = element_text(size = 14, family = "Tahoma", face = "bold"),
        text = element_text(size = 12, family = "Tahoma"),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11)) 
Fig4e
ggsave("Fig4e_Data-Clean-New_Ecoregion-Proximity-Width.png", dpi = 800)

Fig4f <- ggplot(subset(Clean, Epoch=="Anthropocene"), aes(x = Ecoregion, y = Globosity_WoverL, fill = Coastal_Proximity)) +
  geom_boxplot(alpha=0.7) +
  coord_cartesian(ylim = c(.4,.72)) +
  scale_y_continuous(name = "Shape (Globosity, W/L)") +
  scale_x_discrete(name = "Ecoregion") +
  ggtitle("(f)") +
  theme_bw() +
  theme(plot.title = element_text(size = 14, family = "Tahoma", face = "bold"),
        text = element_text(size = 12, family = "Tahoma"),
        axis.title = element_text(face="bold"),
        axis.text.x=element_text(size = 11)) 
Fig4f
ggsave("Fig4f_Data-Clean-New_Ecoregion-Proximity-Width.png", dpi = 800)



Fig5a = plot_grid(sys.plot, dia.plot, labels = "a", label_size=12)
Fig5a   

```

Tables 1-2: Statistics, namely for Figs 3-4 (Clean_New)
```{r}

# Table 1 (for Fig 3)
Clean_Numeric <- Clean_New # This is to have lm() Epoch show up as one instead of breakdown
Clean_Numeric$Epoch<-as.numeric(Clean_Numeric$Epoch)

Fig3a_aov <- aov(Width_mm ~ Latitude + Epoch + Latitude*Epoch, data = Clean_New)
Fig3a_GIM <- lm(Width_mm ~ Latitude + Epoch + Latitude*Epoch, data = Clean_Numeric)

Fig3b_aov <- aov(Width_mm ~ Mean_SST + Epoch + Mean_SST*Epoch, data = Clean_New)
Fig3b_GIM <- lm(Width_mm ~ Mean_SST + Epoch + Mean_SST*Epoch, data = Clean_Numeric)

Fig3c_aov <- aov(Globosity_WoverL ~ Latitude + Epoch + Latitude*Epoch, data = Clean_New)
Fig3c_GIM <- lm(Globosity_WoverL ~ Latitude + Epoch + Latitude*Epoch, data = Clean_Numeric)

Fig3d_aov <- aov(Globosity_WoverL ~ Mean_SST + Epoch + Mean_SST*Epoch, data = Clean_New)
Fig3d_GIM <- lm(Globosity_WoverL ~ Mean_SST + Epoch + Mean_SST*Epoch, data = Clean_Numeric)

# For Supp Fig 2
SuppFig2a_aov <- aov(Mean_SST ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_New, Epoch=="Pleistocene")) # interaction by ecoregion only

SuppFig2b_aov <- aov(Mean_SST ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_New, Epoch=="Holocene")) # significant interaction
SuppFig2b_GIM <- lm(Mean_SST ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_New, Epoch=="Holocene")) # significant for all

SuppFig2c_aov <- aov(Mean_SST ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_New, Epoch=="Anthropocene")) # significant interaction
SuppFig2c_GIM <- lm(Mean_SST ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_New, Epoch=="Anthropocene")) # significant for all

# Table 2 (for Fig 4)
Clean_Numeric <- Clean_New # Need to re-do for filter by Epoch
Clean_Numeric$Ecoregion <- as.numeric(Clean_Numeric$Ecoregion)
Clean_Numeric$Coastal_Proximity <- as.numeric(Clean_Numeric$Coastal_Proximity)

Fig4a_aov <- aov(Width_mm ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_New, Epoch=="Pleistocene")) # no significance
Fig4a_GIM <- lm(Width_mm ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_Numeric, Epoch=="Pleistocene"))

Fig4b_aov <- aov(Width_mm ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_New, Epoch=="Holocene")) # significant interaction
Fig4b_GIM <- lm(Width_mm ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_Numeric, Epoch=="Holocene")) # significant for all

Fig4c_aov <- aov(Width_mm ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_New, Epoch=="Anthropocene")) # significant interaction
Fig4c_GIM <- lm(Width_mm ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_Numeric, Epoch=="Anthropocene")) # significant for all

Fig4d_aov <- aov(Globosity_WoverL ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_New, Epoch=="Pleistocene")) # no significance
Fig4d_GIM <- lm(Globosity_WoverL ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_Numeric, Epoch=="Pleistocene")) # no significance

Fig4e_aov <- aov(Globosity_WoverL ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_New, Epoch=="Holocene")) # significant interaction
Fig4e_GIM <- lm(Globosity_WoverL ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_Numeric, Epoch=="Holocene")) # significant for all

Fig4f_aov <- aov(Globosity_WoverL ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_New, Epoch=="Anthropocene")) # significant interaction
Fig4f_GIM <- lm(Globosity_WoverL ~ Ecoregion + Coastal_Proximity + Ecoregion*Coastal_Proximity, data = subset(Clean_Numeric, Epoch=="Anthropocene")) # no significance between ecoregions

# Tables 1, 2
Tab1 <- list(Fig3a_GIM, Fig3b_GIM, Fig3c_GIM, Fig3d_GIM)
Tab2 <- list(Fig4a_GIM, Fig4b_GIM, Fig4c_GIM, Fig4d_GIM, Fig4e_GIM, Fig4f_GIM) 

# Print summaries of each respective table 
for(i in Tab1){
 
 print(summary(i))
  # r <- summary(i)$adj.r.squared
 # print(r)
}

for(i in Tab2){
 
 print(summary(i))
  # r <- summary(i)$adj.r.squared
 # print(r)
}

```

Supplemental Figure 3: Relationship to human population density
```{r}

SuppFig3 = subset(Clean_New, Epoch!="Pleistocene")
SuppFig3 = subset(SuppFig3, Collection!="PR") # Removed personal research (biases SD)
SuppFig3 = subset(SuppFig3, Population_Density > 0) # 1349 observations

# Create a column that converts population density to categories by standard deviation
min(SuppFig3$Population_Density) # 0.00932179
x <- mean(SuppFig3$Population_Density) # 247.2658
SD <- sd(SuppFig3$Population_Density) # 546.268
max(SuppFig3$Population_Density) # 2708.81

SuppFig3$Human_pop[SuppFig3$Population_Density < (617-546)] <- "Low"
SuppFig3$Human_pop[SuppFig3$Population_Density > (617+546)] <- "High"
SuppFig3$Human_pop[SuppFig3$Population_Density > (617-545) & 
                     SuppFig3$Population_Density < (617+545)] <- "Medium"

# Supp Fig 3a-b 
SuppFig3a = ggplot(data = SuppFig3, 
                      aes(x = Decade, y = Width_mm,
                      color = Human_pop,
                      alpha = 0.4)) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Human_pop)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Decade", y="Size (Width mm)")
SuppFig3a +
  theme_classic() 
ggsave("SuppFig3a_Data-Clean_New_Decade-Width-Human.png", dpi = 800)
# Regression by category
ggplotRegression(lm(Width_mm ~ Decade, data = SuppFig3))
# ** y = 114.07 - 0.053x, r^2 = 0.076, p = 2.118e-23
ggplotRegression(lm(Width_mm ~ Decade, data = subset(SuppFig3, Human_pop=="Low")))
# ** y = 147.5 - 0.070x, r^2 = 0.162, p = 1.87e-38
ggplotRegression(lm(Width_mm ~ Decade, data = subset(SuppFig3, Human_pop=="Medium")))
# ** y = -197.93 + 0.107x, r^2 = 0.059, p = 0.00014
ggplotRegression(lm(Width_mm ~ Decade, data = subset(SuppFig3, Human_pop=="High")))
# ** y = 583.62 - 0.291x, r^2 = 0.394, p = 1.309e-10

SuppFig3b = ggplot(data = SuppFig3, 
                      aes(x = Decade, y = Globosity_WoverL,
                      color = Human_pop,
                      alpha = 0.4)) +
  geom_smooth(se = FALSE, method = lm) +
  geom_smooth(method = lm, color = "black") + # 95% confidence
  geom_point(aes(color = Human_pop)) + 
  geom_errorbar(stat="summary", fun.data="mean_se", fun.args = list(mult = 1.96), width=0) +
    geom_smooth(method=lm, se = TRUE, alpha = 0.35) + # 95% confidence interval
  labs(x="Decade", y="Globosity, W/L")
SuppFig3b +
  theme_classic() 
ggsave("SuppFig3b_Data-Clean_New_Decade-Globosity-Human.png", dpi = 800)

ggplotRegression(lm(Globosity_WoverL ~ Decade, data = SuppFig3))
# y = 0.444 + 6.99e-5x, r^2 = 0.002, p = 0.074
ggplotRegression(lm(Globosity_WoverL ~ Decade, data = subset(SuppFig3, Human_pop=="Low")))
# ** y = 0.019x - 2.88e-4x, r^2 = 0.028, p = 8.486e-8
ggplotRegression(lm(Globosity_WoverL ~ Decade, data = subset(SuppFig3, Human_pop=="Medium")))
# ** y = 1.858 - 6.49e-4x, r^2 = 0.101, p = 4.326e-7
ggplotRegression(lm(Globosity_WoverL ~ Decade, data = subset(SuppFig3, Human_pop=="High")))
# y = 0.795 - 1.11e-4x, r^2 = 0.002, p = 0.249

```

Cope's Rule
```{r}

Copes <- Clean_New[c("Location", "Epoch", "Width_mm", "Length_mm", "Globosity_WoverL")]
Copes <- Copes[complete.cases(Copes), ] # removes NAs from all rows to only compare where all measurements are available

All_Locales <- lm(Width_mm ~ Location + Epoch + Location*Epoch , data = Clean_New) # interaction by ecoregion only
summary(All_Locales)
Merged <- aov(Width_mm ~ Epoch , data = Clean_New) # interaction by ecoregion only
summary(Merged) # yes, significant by size

# bar plot
# width, locations merge by epoch
Copes_new <- Copes %>% select("Location", "Epoch", "Width_mm") %>%
  group_by(Epoch) %>%            # group data for limit calculation
  mutate(upper = mean(Width_mm) + sd(Width_mm), # upper limit for error bar
         lower = mean(Width_mm) - sd(Width_mm)) # lower limit for error bar


Width <- ggplot(Copes_new, aes(x = Epoch, y = Width_mm, fill = Epoch)) +
  stat_summary(fun.y = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                width = .2,                    # Width of the error bars
                position = position_dodge(.9))
ggsave("Copes_Widthmm_Epoch-All.png", dpi = 800)

# width, locations separated out
Copes_new <- Copes %>% select("Location", "Epoch", "Width_mm") %>%
  group_by(Epoch, Location) %>%            # group data for limit calculation
  mutate(upper = mean(Width_mm) + sd(Width_mm), # upper limit for error bar
         lower = mean(Width_mm) - sd(Width_mm)) # lower limit for error bar

Width <- ggplot(Copes_new, aes(x = Location, y = Width_mm, fill = Epoch)) +
  stat_summary(fun.y = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                width = .2,                    # Width of the error bars
                position = position_dodge(.9))
Width
ggsave("Copes_Widthmm_Epoch-by-Location.png", dpi = 800)


# Length
Copes_new <- Copes %>% select("Location", "Epoch", "Length_mm") %>%
  group_by(Epoch) %>%            # group data for limit calculation
  mutate(upper = mean(Length_mm) + sd(Length_mm), # upper limit for error bar
         lower = mean(Length_mm) - sd(Length_mm)) # lower limit for error bar

Length <- ggplot(Copes_new, aes(x = Epoch, y = Length_mm, fill = Epoch)) +
  stat_summary(fun.y = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                width = .2,                    # Length of the error bars
                position = position_dodge(.9))
ggsave("Copes_Lengthmm_Epoch-All.png", dpi = 800)

# Length, locations separated out
Copes_new <- Copes %>% select("Location", "Epoch", "Length_mm") %>%
  group_by(Epoch, Location) %>%            # group data for limit calculation
  mutate(upper = mean(Length_mm) + sd(Length_mm), # upper limit for error bar
         lower = mean(Length_mm) - sd(Length_mm)) # lower limit for error bar

Length <- ggplot(Copes_new, aes(x = Location, y = Length_mm, fill = Epoch)) +
  stat_summary(fun.y = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                width = .2,                    # Length of the error bars
                position = position_dodge(.9))
Length
ggsave("Copes_Lengthmm_Epoch-by-Location.png", dpi = 800)

# Globosity
Copes_new <- Copes %>% select("Location", "Epoch", "Globosity_WoverL") %>%
  group_by(Epoch) %>%            # group data for limit calculation
  mutate(upper = mean(Globosity_WoverL) + sd(Globosity_WoverL), # upper limit for error bar
         lower = mean(Globosity_WoverL) - sd(Globosity_WoverL)) # lower limit for error bar

Length <- ggplot(Copes_new, aes(x = Epoch, y = Globosity_WoverL, fill = Epoch)) +
  stat_summary(fun.y = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                width = .2,                    # Length of the error bars
                position = position_dodge(.9))
ggsave("Copes_Globosity_Epoch-All.png", dpi = 800)

Copes_new <- Copes %>% select("Location", "Epoch", "Globosity_WoverL") %>%
  group_by(Epoch, Location) %>%            # group data for limit calculation
  mutate(upper = mean(Globosity_WoverL) + sd(Globosity_WoverL), # upper limit for error bar
         lower = mean(Globosity_WoverL) - sd(Globosity_WoverL)) # lower limit for error bar

Length <- ggplot(Copes_new, aes(x = Location, y = Globosity_WoverL, fill = Epoch)) +
  stat_summary(fun.y = mean, geom = "bar", position = position_dodge(width = .9),
               size = 3) +
  geom_errorbar(aes(ymin = lower, ymax = upper),
                width = .2,                    # Length of the error bars
                position = position_dodge(.9))
Length
ggsave("Copes_Globosity_Epoch-by-Location.png", dpi = 800)

```
